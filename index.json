


[{"content":"","date":"15 August 2024","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","date":"15 August 2024","externalUrl":null,"permalink":"/coding/","section":"Codings","summary":"","title":"Codings","type":"coding"},{"content":"","date":"15 August 2024","externalUrl":null,"permalink":"/tags/llm/","section":"Tags","summary":"","title":"LLM","type":"tags"},{"content":"","date":"15 August 2024","externalUrl":null,"permalink":"/","section":"QingJiu","summary":"","title":"QingJiu","type":"page"},{"content":"","date":"15 August 2024","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"15 August 2024","externalUrl":null,"permalink":"/categories/%E6%8A%80%E6%9C%AF/","section":"Categories","summary":"","title":"æŠ€æœ¯","type":"categories"},{"content":"","date":"15 August 2024","externalUrl":null,"permalink":"/ja/categories/%E6%8A%80%E8%A1%93/","section":"Categories","summary":"","title":"æŠ€è¡“","type":"categories"},{"content":"\ræœ€å¼€å§‹ #\rå‘ç°äº†ä¸€ä¸ªç”¨langchainå»åšRAGçš„å­¦ä¹ é¡¹ç›®ï¼Œäºæ˜¯å°±å¼€å§‹æ–°çŸ¥è¯†çš„æ¢ç´¢ï¼Œè®°å½•ä¸€ä¸‹è‡ªå·±è¸©è¿‡çš„å‘\nLCEL(LangChain Expression Language) #\rè¿™æ˜¯langchainç‰¹æœ‰çš„ä¸€ç§è¯­è¨€æ¨¡å¼ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨é‡Œé¢çš„chainçš„æ—¶å€™ã€‚è¿™ç§å¥‡æ€ªçš„è¯­æ³•çœŸçš„åœ¨ä¸€å¼€å§‹ç»™æˆ‘çœ‹æ‡µäº†ï¼Œè²Œä¼¼ä»€ä¹ˆä¸œè¥¿éƒ½èƒ½å¾€chainé‡Œé¢å¡çš„ã€‚\nè€Œlangchainçš„æ ¸å¿ƒä¹Ÿå°±åœ¨è¿™ä¸ªchainä¸Šã€‚è€ŒLangchainå®é™…ä¸Šæ˜¯é€šè¿‡é‡å†™äº†| (__or__) æ¥å®ç°å®ƒã€‚\nè€Œé€šè¿‡|ï¼Œå¯ä»¥å°†å„ä¸ªéƒ¨åˆ†é“¾æ¥åœ¨ä¸€èµ·ç»„æˆä¸€æ¡chainï¼Œå‰é¢çš„è¾“å‡ºä½œä¸ºåé¢çš„è¾“å…¥ã€‚æ¥ä¸‹æ¥é€šè¿‡ä»£ç å…·ä½“çœ‹çœ‹ã€‚\næ¯”å¦‚è¿›è¡Œæ•°æ®ä¼ é€’ï¼š\nfrom langchain_core.prompts import ChatPromptTemplate\rfrom langchain_core.output_parsers import StrOutputParser\rfrom langchain_core.runnables import RunnablePassthrough\rprompt = ChatPromptTemplate.from_template(\r\u0026#34;{topic}ã®ä¸€ã¤æ­´å²çš„ãªè©±ã‚’æ•™ãˆã¦ãã ã•ã„\u0026#34;\r)\routput_parser = StrOutputParser()\rllm = SelfGPT()\r#use lcel\rchain = (\r{\u0026#34;topic\u0026#34;: RunnablePassthrough()}\r| prompt\r| llm\r| output_parser\r)\rchain.invoke(\u0026#34;äº¬éƒ½\u0026#34;) \u0026#39;Assistant: äº¬éƒ½ã«ã¯å¤šãã®æ­´å²çš„ãªè©±ãŒã‚ã‚Šã¾ã™ãŒã€ãã®ä¸­ã§ã‚‚æœ‰åãªã®ã¯ã€Œå¹³ç­‰é™¢é³³å‡°å ‚ã€ã®è©±ã§ã™ã€‚ã“ã®å»ºç‰©ã¯å¹³å®‰æ™‚ä»£ã«å»ºã¦ã‚‰ã‚ŒãŸã‚‚ã®ã§ã€å¹³ç­‰é™¢ã¨ã„ã†å¯ºé™¢ã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚é³³å‡°å ‚ã¯éå¸¸ã«ç¾ã—ãã€ç‹¬ç‰¹ãªæ§˜å¼ã§å»ºã¦ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å»ºç‰©ã¯ä½•åº¦ã‚‚æ”¹ä¿®ã•ã‚Œã¦ãã¾ã—ãŸãŒã€ç¾åœ¨ã‚‚ãã®ç¾ã—ã•ã¯å¥åœ¨ã§ã™ã€‚\\n\\nã¾ãŸã€é³³å‡°å ‚ã®åº­åœ’ã«ã¯ã€Œé’é¾ã€ã€Œç™½è™ã€ã€Œæœ±é›€ã€ã€Œç„æ­¦ã€ã¨ã„ã†å››éœŠã®çŸ³åƒãŒã‚ã‚Šã€ãã‚Œãã‚ŒãŒæ±è¥¿å—åŒ—ã‚’è±¡å¾´ã—ã¦ã„ã¾ã™ã€‚ã“ã®åº­åœ’ã¯éå¸¸ã«ç¾ã—ãã€é™ã‹ãªç©ºæ°—ãŒæµã‚Œã¦ã„ã¾ã™ã€‚é³³å‡°å ‚ã¯ä¸–ç•Œéºç”£ã«ã‚‚ç™»éŒ²ã•ã‚Œã¦ãŠã‚Šã€å¤šã\u0026#39; RunnablePassthrough:å…è®¸å°†è¾“å…¥æ•°æ®ä¼ é€’è€Œä¸åšæ›´æ”¹ï¼Œå¯ä»¥åœ¨éœ€è¦æ—¶å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œæ•°æ®çš„å¡«å……ã€‚ç»å¸¸ä¼šå’ŒRunnableParallelä¸€èµ·ä½¿ç”¨ã€‚\nç”±äºæˆ‘è®¾ç½®äº†è¾“å‡ºçš„tokenä¸Šé™ï¼Œäºæ˜¯è¾“å‡ºå°±æˆªæ–­äº†ã€‚ å¯ä»¥çœ‹åˆ°é€šè¿‡è°ƒç”¨invoke()å‡½æ•°å¯ä»¥è¿›è¡Œæ•°æ®çš„ä¼ é€’ã€‚\nè€Œåœ¨å¤æ‚çš„å·¥ä½œæµä¸­ï¼Œinvoke()å¯ä»¥ä¸å¤šä¸ªæ­¥éª¤ç»“åˆä½¿ç”¨ï¼Œè¿›è¡Œé€æ­¥æ‰§è¡Œã€‚\ntemp_prompt = prompt.invoke({\u0026#34;topic\u0026#34;: \u0026#34;éŒå€‰\u0026#34;})\rtemp_prompt ChatPromptValue(messages=[HumanMessage(content=\u0026#39;éŒå€‰ã®ä¸€ã¤æ­´å²çš„ãªè©±ã‚’æ•™ãˆã¦ãã ã•ã„\u0026#39;)]) å†å°†è¿™ä¸ªpromptçš„è¾“å…¥ä¼ å…¥llmï¼š\ntemp_llm = llm.invoke(temp_prompt)\rtemp_llm \u0026#39;éŒå€‰ã«ã¯å¤šãã®æ­´å²çš„ãªè©±ãŒã‚ã‚Šã¾ã™ãŒã€ãã®ä¸­ã§ã‚‚ä»£è¡¨çš„ãªã‚‚ã®ã®ä¸€ã¤ãŒæºé ¼æœã®é¶´å²¡å…«å¹¡å®®å‚è©£ã§ã™ã€‚\\n\\næºé ¼æœã¯éŒå€‰å¹•åºœã®åˆä»£å°†è»ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã€1180å¹´ä»£æœ«ã«ã¯å¹³æ°ã¨ã®é•·ã„æˆ¦ã„ã«å‹åˆ©ã—ã¦ã€å¹•åºœã‚’ç¢ºç«‹ã—ã¾ã—ãŸã€‚ãã®å¾Œã€é ¼æœã¯éŒå€‰å‘¨è¾ºã«å¤šãã®å¯ºç¤¾ã‚’å¯„é€²ã—ã€é¶´å²¡å…«å¹¡å®®ã«ã‚‚å¤šå¤§ãªæ©æµã‚’ä¸ãˆãŸã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚\\n\\nã¾ãŸã€é ¼æœã¯è‡ªã‚‰ã‚‚é¶´å²¡å…«å¹¡å®®ã‚’å‚è©£ã—ã€ãã®éš›ã«ã¯å¾“è€…ãŸã¡ã¨ã¨ã‚‚ã«æ•°ç™¾é ­ã‚‚ã®é¦¬ã‚’é€£ã‚Œã¦è¡Œã£ãŸã¨ã„ã†é€¸è©±ã‚‚æ®‹ã£ã¦ã„ã¾ã™ã€‚ã“ã®å‚è©£ã«ã‚ˆã£ã¦ã€\u0026#39; åŒæ—¶ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®äº†è‡ªå·±çš„langsmith apiï¼Œä¹Ÿå¯ä»¥å»langsmithä¸Šç›´è§‚çš„æŸ¥çœ‹å„ä¸ªæ¨¡å—çš„è¾“å…¥è¾“å‡ºï¼š\nå¯ä»¥çœ‹åˆ°è¿™å…¶å®æ˜¯ä¸€ç³»åˆ—çš„ä¸²è¡Œå¤„ç†ã€‚\nMulti Query #\rä¸€ç§RAGä¸­çš„æŠ€æœ¯ï¼Œåˆ©ç”¨promptå’Œllmä»åŸæœ¬ç”¨æˆ·æé—®çš„queryä¸­ç”Ÿæˆå¤šè§’åº¦çš„ï¼Œé€‚åˆllmå»ç†è§£çš„queryã€‚é€šè¿‡ç”Ÿæˆçš„Multi Queryï¼Œå†å¯¹æ–‡æ¡£åº“è¿›è¡Œretrieveï¼Œå¯ä»¥æ¯”ä¹‹å‰å¾—åˆ°æ›´åŠ å…¨é¢çš„ç»“æœã€‚\nä»¥ä¸‹æ˜¯ä¸€æ®µå¸¸ç”¨çš„promptï¼š\ntemplate = \u0026#34;\u0026#34;\u0026#34;You are an AI language model assistant. Your task is to generate five different versions of the given user question to retrieve relevant documents from a vector database. By generating multiple perspectives on the user question, your goal is to help\rthe user overcome some of the limitations of the distance-based similarity search. Provide these alternative questions separated by newlines. Original question: {question}\u0026#34;\u0026#34;\u0026#34;\rprompt_perspectives = ChatPromptTemplate.from_template(template) RAG-Fusion #\rrag fusionï¼Œå®ƒçš„ä¸»è¦æ€æƒ³æ˜¯åœ¨Multi Queryçš„åŸºç¡€ä¸Šï¼Œå¯¹å…¶æ£€ç´¢ç»“æœè¿›è¡Œé‡æ–°æ’åº(å³reranking)åè¾“å‡ºTop Kä¸ªæœ€ç›¸å…³æ–‡æ¡£ï¼Œæœ€åå°†è¿™top kä¸ªæ–‡æ¡£å–‚ç»™LLMå¹¶ç”Ÿæˆæœ€ç»ˆçš„ç­”æ¡ˆ(answer)ã€‚\nå…·ä½“çš„é‡æ–°æ’åºæ–¹æ³•ï¼Œåœ¨langchainçš„å®˜æ–¹æ•™å­¦æ–‡æ¡£ä¸­é‡‡ç”¨äº†RRF(Reciprocal rank fusion)ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ¥è‡ªå¤šä¸ªæ£€ç´¢ç³»ç»Ÿæˆ–æ¨¡å‹çš„æ’åç»“æœè¿›è¡Œèåˆï¼Œé€šè¿‡ä¸€ç§ç®€å•çš„åŠ æƒæ–¹å¼æ¥ç»¼åˆè¿™äº›ç»“æœï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ›´å¥½çš„æœ€ç»ˆæ’åºã€‚å…·ä½“æ¥è¯´ï¼ŒRRF åŸºäºæ¯ä¸ªç»“æœçš„å€’æ•°æ’åï¼ˆreciprocal rankï¼‰æ¥è¿›è¡Œèåˆã€‚\ndef reciprocal_rank_fusion(results: list[list], k=60):\r\u0026#34;\u0026#34;\u0026#34; Reciprocal_rank_fusion that takes multiple lists of ranked documents and an optional parameter k used in the RRF formula \u0026#34;\u0026#34;\u0026#34;\r# Initialize a dictionary to hold fused scores for each unique document\rfused_scores = {}\r# Iterate through each list of ranked documents\rfor docs in results:\r# Iterate through each document in the list, with its rank (position in the list)\rfor rank, doc in enumerate(docs):\r# Convert the document to a string format to use as a key (assumes documents can be serialized to JSON)\rdoc_str = dumps(doc)\r# If the document is not yet in the fused_scores dictionary, add it with an initial score of 0\rif doc_str not in fused_scores:\rfused_scores[doc_str] = 0\r# Retrieve the current score of the document, if any\rprevious_score = fused_scores[doc_str]\r# Update the score of the document using the RRF formula: 1 / (rank + k)\r# higher rank, higher scores\rfused_scores[doc_str] += 1 / (rank + k)\r# Sort the documents based on their fused scores in descending order to get the final reranked results\rreranked_results = [\r(loads(doc), score)\rfor doc, score in sorted(fused_scores.items(), key=lambda x: x[1], reverse=True)\r]\r# Return the reranked results as a list of tuples, each containing the document and its fused score\rreturn reranked_results åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œè®©å¹³æ»‘å› å­kä¸º60ã€‚é€‰æ‹© k=60 æ˜¯ä¸ºäº†ç¡®ä¿å³ä½¿æŸäº›æ–‡æ¡£åœ¨æŸä¸ªæ£€ç´¢ç»“æœä¸­çš„æ’åéå¸¸é å‰ï¼ˆä¾‹å¦‚æ’åä¸º 1ï¼‰ï¼Œå…¶è¯„åˆ†ä¹Ÿä¸ä¼šè¿‡é«˜ã€‚è¿™æœ‰åŠ©äºé¿å…åœ¨è¯„åˆ†è¿‡ç¨‹ä¸­å‡ºç°æç«¯å€¼ï¼Œä½¿å¾—è¯„åˆ†æ›´åŠ ç¨³å®šå’Œåˆç†ã€‚\nåœ¨è¿™ä¸ªåº”ç”¨ä¸­ä¹Ÿçœ‹åˆ°äº†langchainè¿™ç§åµŒå¥—å¼çš„å†™æ³•(ä¸å®Œæ•´çš„ä»£ç ï¼Œåªæ˜¯ä¸ºäº†ç†è§£è§‚çœ‹)ï¼š\nprompt_rag_fusion = ChatPromptTemplate.from_template(template)\rgenerate_queries = (\rprompt_rag_fusion | SelfGPT()\r| StrOutputParser() | (lambda x: x.split(\u0026#34;\\n\u0026#34;))\r)\rretrieval_chain_rag_fusion = generate_queries | retriever.map() | reciprocal_rank_fusion\rfinal_rag_chain = (\r{\u0026#34;context\u0026#34;: retrieval_chain_rag_fusion, \u0026#34;question\u0026#34;: itemgetter(\u0026#34;question\u0026#34;)} | prompt\r| SelfGPT()\r| StrOutputParser()\r) Decomposition #\råˆ†è§£Decompositionä»£è¡¨äº†å¢å¼ºç®€å•æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æ–¹æ³•çš„å¦ä¸€ç§åˆ›æ–°æŠ€æœ¯ã€‚åˆ†è§£æŠ€æœ¯æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„ç­–ç•¥ï¼Œæ¶‰åŠå°†å¤æ‚çš„é—®é¢˜æˆ–é—®é¢˜åˆ†è§£ä¸ºæ›´å°ã€æ›´æ˜“äºç®¡ç†çš„å­é—®é¢˜ï¼Œç‹¬ç«‹åœ°è§£å†³æ¯ä¸ªé—®é¢˜ï¼Œç„¶åæ•´åˆå®ƒä»¬çš„è§£å†³æ–¹æ¡ˆä»¥å½¢æˆå…¨é¢çš„ç­”æ¡ˆã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¯¹é—®é¢˜çš„æ¯ä¸ªç»„æˆéƒ¨åˆ†è¿›è¡Œé‡ç‚¹å’Œè¯¦ç»†çš„åˆ†æï¼Œä»è€Œä¿ƒè¿›æ›´ç®€å•ã€æ›´æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å•ç‹¬è§£å†³å­é—®é¢˜ï¼Œå®ƒå¯ä»¥åˆ©ç”¨ç®€å•æ€§æ¥è§£å†³å¤æ‚é—®é¢˜ï¼Œç¡®ä¿å¯¹ä¸»è¦é—®é¢˜çš„å½»åº•ç†è§£å’Œè§£å†³ã€‚åˆ†è§£ä¸ä»…å¢å¼ºäº†é—®é¢˜è§£å†³è¿‡ç¨‹çš„æ¸…æ™°åº¦å’Œæ•ˆç‡ï¼Œè€Œä¸”æé«˜äº†è§£å†³æ–¹æ¡ˆçš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§ã€‚\nä»¥ä¸‹æ˜¯ä¸€æ®µå¸¸ç”¨çš„promptï¼š\ntemplate = \u0026#34;\u0026#34;\u0026#34;You are a helpful assistant that generates multiple sub-questions related to an input question. \\n\rThe goal is to break down the input into a set of sub-problems / sub-questions that can be answers in isolation. \\n\rGenerate multiple search queries related to: {question} \\n\rOutput (3 queries):\u0026#34;\u0026#34;\u0026#34; åœ¨å…·ä½“å®ç°ä¸­ï¼Œæœ‰Answer recursivelyå’ŒAnswer individuallyä¸¤ç§æ–¹æ³•ã€‚\nAnswer recursivelyæ˜¯å°†åˆ†è§£åçš„é—®é¢˜ä¸€ä¸€è¾“å…¥llmï¼Œå‰é¢answerå¾—åˆ°çš„ç­”æ¡ˆä¸å‰é¢çš„queryä¸€èµ·ä½œä¸ºä¸‹ä¸€ä¸ªqueryçš„promptå†…å®¹ï¼Œæ¥è¿›è¡Œæ›´å¥½çš„æç¤ºã€‚\nAnswer individuallyæ˜¯ä¸€ä¸ªåˆ†æ€»çš„ç»“æ„ã€‚å…ˆæŠŠæ¯ä¸ªquestionåˆ†å‰²æˆsubquestionï¼Œåˆ†åˆ«å¾—åˆ°å„è‡ªçš„é—®é¢˜ï¼Œç„¶åå¯¹å„è‡ªçš„é—®é¢˜è¿›è¡Œè·å¾—ç­”æ¡ˆã€‚æœ€åæŠŠè¿™äº›é—®é¢˜ç­”æ¡ˆå¯¹ä½œä¸ºpromptè¾“å…¥ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç­”æ¡ˆã€‚\nStepBack #\rå¦ä¸€ç§promptæ€è·¯ã€‚\nåœ¨å…·ä½“ç”Ÿæ´»ä¸­ï¼Œäººç±»åœ¨è§£å†³ä¸€ä¸ªåŒ…å«å¾ˆå¤šç»†èŠ‚çš„å…·ä½“é—®é¢˜æ—¶ï¼Œå…ˆç«™åœ¨æ›´é«˜çš„å±‚æ¬¡ä¸Šè§£å†³ä¸€äº›æ›´åŠ æŠ½è±¡çš„é—®é¢˜ï¼Œå¯ä»¥æ‹“å±•ä¸€ä¸ªæ›´å®½é˜”çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä»è€Œè¾…åŠ©è§£å†³è¿™ä¸ªå…·ä½“çš„é—®é¢˜ã€‚\nååº”åˆ°LLMä¸­ï¼Œå°±æ˜¯å½“é—®LLMä¸€ä¸ªå…·ä½“çš„ç‰©ç†é¢˜ç›®æ—¶ï¼Œå…ˆè®©LLMè§£å†³ä¸€ä¸ªæ›´åŠ é«˜å±‚æ¬¡çš„æŠ½è±¡é—®é¢˜ã€‚æ¯”å¦‚æ€è€ƒè¿™ä¸ªé—®é¢˜èƒŒåç”¨å¾—åˆ°ç‰©ç†å®šå¾‹æˆ–æ³•åˆ™æ˜¯ä»€ä¹ˆï¼Œç„¶åå†è®©LLMå»è§£å†³é‚£ä¸ªåŒ…å«äº†å¾ˆå¤šç»†èŠ‚çš„å…·ä½“çš„ç‰©ç†é¢˜ç›®ï¼Œå¯èƒ½æ•ˆæœå°±ä¼šæ›´å¥½ï¼Œå‡†ç¡®ç‡æ›´é«˜ã€‚\nå› æ­¤ï¼Œä¹Ÿå°±æœ‰äº†Step-Backçš„promptingæ€è·¯ã€‚\nHyDE #\ré‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦LLMç”Ÿæˆå‡è®¾æ€§å›ç­”ï¼Ÿ\nåœ¨é¢å¯¹ç¼ºä¹å…·ä½“æ€§æˆ–ç¼ºä¹æ˜“äºè¯†åˆ«çš„å…ƒç´ ä»ç»™å®šä¸Šä¸‹æ–‡ä¸­æ¨å¯¼ç­”æ¡ˆçš„é—®é¢˜æ—¶ï¼Œæœ‰æ—¶å€™ä¼šç›¸å½“å…·æœ‰æŒ‘æˆ˜æ€§ã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘å°¼åº·çš„æƒ…å†µï¼Œå®ƒé€šå¸¸ä»¥æ‘„å½±å™¨æè€Œé—»åã€‚ç„¶è€Œï¼Œå¦‚æœæœ‰äººè¯¢é—®å°¼åº·æœ€å¥½çš„è®¾å¤‡æ˜¯ä»€ä¹ˆï¼Œè¿™ä¸ªé—®é¢˜æš—ç¤ºäº†å¯¹æ‘„å½±è®¾å¤‡çš„å…³æ³¨ã€‚è¿™é‡Œçš„éš¾ç‚¹åœ¨äºæ²¡æœ‰æŒ‡å®šå…·ä½“çš„è®¾å¤‡ã€‚å› æ­¤ï¼Œå¯»æ‰¾æ´å¯ŸåŠ›å˜å¾—æœ‰å›°éš¾ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨HyDEã€‚\nHyDE (Hypothetical Document Embeddings) çš„æœ¬è´¨æ˜¯ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹ (LLM) ä¸ºç”¨æˆ·æŸ¥è¯¢ç”Ÿæˆå‡è®¾æ–‡æ¡£ã€‚è¿™äº›æ–‡æ¡£æ˜¯æ ¹æ® LLM æœ¬èº«çš„çŸ¥è¯†ç”Ÿæˆçš„ï¼Œå¯èƒ½åŒ…å«é”™è¯¯æˆ–ä¸å‡†ç¡®ä¹‹å¤„ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä¸ RAG çŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£ç›¸å…³è”ã€‚ç„¶åï¼Œé€šè¿‡ä½¿ç”¨è¿™äº›å‡è®¾æ–‡æ¡£æ¥æ£€ç´¢å…·æœ‰ç›¸ä¼¼å‘é‡çš„çœŸå®æ–‡æ¡£ï¼Œä»è€Œæé«˜æ£€ç´¢çš„å‡†ç¡®æ€§ã€‚\nå…·ä½“æ¥è§£é‡Šä¸€ä¸‹è¿™å¼ å›¾ï¼šç”¨æˆ·æœ¬èº«è¾“å…¥çš„æŸ¥è¯¢ä¸ºquestionï¼Œå®ƒæ‰€åæ˜ åˆ°åµŒå…¥ç©ºé—´ä¸­æ˜¯é»„è‰²çš„åæ ‡ï¼Œè€Œè·ç¦»ragæä¾›çš„documentsçš„åæ ‡ï¼ˆçº¢è‰²ï¼Œç»¿è‰²ï¼Œè“è‰²ï¼‰éƒ½æœ‰ä¸€å®šçš„è·ç¦»ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨HyDEå»è®©LLMæ ¹æ®questionç”Ÿæˆhypothetical documentï¼Œç”¨å®ƒå»ç”ŸæˆåµŒå…¥ç©ºé—´ä¸­çš„åæ ‡ï¼ˆé»„è‰²ï¼‰ï¼Œç„¶åè¿›è¡Œæ£€ç´¢ã€‚è¿™æ ·å¯ä»¥æé«˜æ£€ç´¢çš„å‡†ç¡®æ€§ã€‚\n","date":"15 August 2024","externalUrl":null,"permalink":"/coding/llm_learning2/","section":"Codings","summary":"blog","title":"å­¦ä¹ ä½¿ç”¨langchainå’ŒRAG","type":"coding"},{"content":"\ræœ€å¼€å§‹ #\ræœ€è¿‘å­¦ä¹ äº†ç›¸å…³çš„NLPçš„åŸºç¡€ï¼Œæ‰“ç®—å¼€å§‹ç€æ‰‹è‡ªå·±æLLMç›¸å…³çš„å…·ä½“åº”ç”¨äº†ã€‚æ¥ä¸‹æ¥å°±ç”¨blogè®°å½•ä¸€ä¸‹è‡ªå·±å­¦RAGä¸­å­¦åˆ°çš„ä¸œè¥¿ã€‚\nä»€ä¹ˆæ˜¯RAGï¼Ÿ #\rRAG(Retrieval-Augmented Generation)æ˜¯ä¸€ç§å°†ä¿¡æ¯æ£€ç´¢å’Œæ–‡æœ¬ç”Ÿæˆç»“åˆçš„æŠ€æœ¯ï¼Œé€šå¸¸ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­ã€‚RAGæ¨¡å‹å°†ä¿¡æ¯æ£€ç´¢ï¼ˆRetrievalï¼‰å’Œç”Ÿæˆ (Generation)ä¸¤ä¸ªé˜¶æ®µç»“åˆèµ·æ¥ï¼Œä»¥æé«˜ç”Ÿæˆçš„æ–‡æœ¬å†…å®¹çš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§ã€‚\nä»¥ä¸Šæ˜¯GPTè¯´çš„ï¼Œçœ‹èµ·æ¥éå¸¸çš„é«˜å¤§ä¸Šæ˜¯ä¸æ˜¯(ç¬‘)ã€‚\nè®©æˆ‘æ¥æ‰“ä¸ªæ¯”æ–¹ï¼šç°åœ¨æœ‰ä¸€ä¸ªå°å­©ï¼Œä½ æƒ³é—®å®ƒæœ‰å…³äºç›¸æœºæ–¹é¢çš„çŸ¥è¯†ã€‚ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯è®©å°å­©å¼€å§‹ä»é›¶å­¦ä¹ ç›¸æœºæ–¹é¢çš„çŸ¥è¯†ï¼Œè‡ªå·±å»ç†è§£é•œå¤´ä¸­çš„å…‰åœˆï¼Œç„¦æ®µ\u0026hellip;è¯¥æ€ ä¹ˆå»æ‘„å½±çš„æ—¶å€™ä½¿ç”¨ï¼Œè¿™ç§æ–¹æ¡ˆå°±æ˜¯SFT(Supervised Fine-Tuning),é€šè¿‡è¾“å…¥æˆ‘ä»¬çš„æ•°æ®(ç›¸æœºæ–¹é¢çš„çŸ¥è¯†)å»è®©é¢„è®­ç»ƒæ¨¡å‹(å°å­©)å­¦ä¹ ï¼Œä»è€Œå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ¨¡å‹(æ‡‚å¾—ç›¸æœºçŸ¥è¯†çš„å°å­©)ã€‚è€Œå¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯RAGï¼Œå®ƒè§‰å¾—è®©å°å­©ä»é›¶å­¦ä¹ ç›¸æœºæ–¹é¢çš„çŸ¥è¯†è¿˜æ˜¯å¤ªéº»çƒ¦äº†ï¼Œç›´æ¥æ‰¾äº†ä¸€æœ¬ç›¸æœºçš„ä¹¦ç»™å°å­©ï¼Œå’Œä»–è¯´ï¼šâ€œç°åœ¨æˆ‘è¦é—®ä½ é—®é¢˜,ä½ ä»è¿™æœ¬ä¹¦é‡Œé¢æ‰¾ç­”æ¡ˆç»™æˆ‘ç»“æœã€‚â€æ‰€ä»¥RAGè¿™ä¸ªæ–¹æ³•å¹¶ä¸ä¼šæ”¹å˜æˆ‘ä»¬çš„æ¨¡å‹(å°å­©)ï¼Œè€Œæ˜¯å¢åŠ äº†è¾“å…¥(ä¹¦)æ¥è¾…åŠ©æ¨¡å‹ç”Ÿæˆæ›´å¥½çš„ç»“æœã€‚\nä¸ºä»€ä¹ˆè¦ç”¨RAGï¼Ÿ #\ræ˜¾è€Œæ˜“è§çš„ï¼ŒRAGå¯ä»¥åœ¨ä¸æ”¹å˜LLMçš„æƒ…å†µä¸‹å»è·å¾—å¥½çš„ç»“æœï¼Œçœå»äº†finetuneæ—¶è€—è´¹çš„æ—¶é—´å’Œç»å†ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æƒ³è¦å­¦ä¹ ä¸€ä¸ªå˜åŒ–å¾ˆé¢‘ç¹çš„åŠ¨æ€æ•°æ®æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨RAGã€‚\nRAGå¯ä»¥å¤„ç†å“ªäº›æ•°æ®ï¼Ÿ #\rRAGä¸ä»…å¯ä»¥å¤„ç†æ–‡æœ¬ç±»å‹çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥å¤„ç†PDFè¿™ç§ç±»å‹çš„æ•°æ®ï¼Œå¯è°“æ˜¯éå¸¸æ–¹ä¾¿äº†ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®ƒè¿˜å¯ä»¥å¤„ç†å¤šæ¨¡æ€ç›¸å…³çš„å†…å®¹ï¼Œåªè¦é›†æˆäº†ç›¸å…³çš„æ¨¡å—å³å¯ã€‚åœ¨è¿™æ¬¡å­¦ä¹ ä¸­ï¼Œæˆ‘ç€ç›®äºæ–‡å­—ç›¸å…³å†…å®¹ã€‚\næ–‡ä»¶æ£€ç´¢ #\ræ¥ä¸‹æ¥è®²è®²RAGæ€ä¹ˆè¿›è¡Œæ–‡æœ¬æ£€ç´¢ã€‚å…·ä½“æ–¹æ³•æœ‰åŸºäºå€’æ’ç´¢å¼•ã€‚\nåŸºäºå€’æ’ç´¢å¼• #\ræˆ‘ä»¬å¹³æ—¶åœ¨ä½¿ç”¨çš„æœç´¢å¼•æ“å°±æ˜¯ä¸€ä¸ªæ–‡æœ¬æ£€ç´¢çš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯åŒ…å«å¤šä¸ªæ­¥éª¤çš„ã€‚\nç®€å•æ¥è¯´ï¼Œé¦–å…ˆå°±æ˜¯å¯¹æ–‡æœ¬è¿›è¡Œé¢„å¤„ç†ï¼Œå˜æˆè§„èŒƒç»Ÿä¸€çš„æ ¼å¼ã€‚æ¯”å¦‚å»é™¤æ ‡ç‚¹ï¼Œåœç”¨è¯Stop Wordsï¼Œå­—æ¯å…¨éƒ¨å˜æˆå°å†™ç­‰ç­‰\u0026hellip;ç„¶åå°±æ˜¯æ„å»ºæ–‡æœ¬çš„ç´¢å¼•ï¼Œæœ¬è´¨å°±æ˜¯æ„å»ºå€’æ’è¡¨ã€‚ä¸»è¦é€»è¾‘æ˜¯è®°å½•æ¯ä¸ªè¯é¡¹ï¼Œä»¥åŠè¯é¡¹æ‰€åœ¨æ–‡æ¡£ä¸­é—´çš„ä½ç½®ä¿¡æ¯ã€‚é€šè¿‡å€’æ’è¡¨Inverted Indexæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¯æ‰€åœ¨çš„æ–‡æ¡£ã€‚\nå¯ä»¥åœ¨è¿™å¼ å›¾ç‰‡ä¸­çœ‹åˆ°è¿™ä¸ªé€»è¾‘ã€‚ç®€å•æ¥è¯´ï¼Œè¯ä½œä¸ºkeyï¼Œæ–‡æ¡£ä½œä¸ºvalueã€‚\næœ€åå°±æ˜¯æ–‡æœ¬æ£€ç´¢ï¼Œé¢„å¤„ç†ç”¨æˆ·æŸ¥è¯¢ï¼Œç„¶åè®¡ç®—æŸ¥è¯¢ä¸­æ¯ä¸ªè¯é¡¹çš„æƒé‡ã€‚å¹¶åˆ©ç”¨æ£€ç´¢ç®—æ³•(TFIDF,BM25)è¿›è¡Œç›¸å…³æ’åºï¼ŒæŠŠç›¸å…³æ€§é«˜çš„æ–‡æ¡£æ’åˆ°å‰é¢ã€‚\nTFIDF #\rTF-IDFï¼ˆTerm Frequency-Inverse Document Frequencyï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„æ–‡æœ¬æŒ–æ˜å’Œä¿¡æ¯æ£€ç´¢æŠ€æœ¯ï¼Œç”¨äºè¡¡é‡è¯æ±‡åœ¨æ–‡æ¡£ä¸­çš„é‡è¦æ€§ã€‚\nç®€å•æ¥è¯´TFæ˜¯è¯é¡¹åœ¨æ–‡æ¡£ä¸­çš„è¯é¢‘ï¼Œè¡¨ç¤ºä¸€ä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¢‘ç‡ã€‚IDFæ˜¯é€†æ–‡æ¡£é¢‘ç‡ï¼Œè¡¨ç¤ºä¸€ä¸ªè¯åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°çš„ç¨€æœ‰ç¨‹åº¦ã€‚\nè®¡ç®—å…¬å¼ï¼š\n$$ \\text{TF-IDF}(t, d, D) = \\text{TF}(t, d) \\times \\text{IDF}(t, D) $$\nå…¶ä¸­ï¼Œğ‘¡æ˜¯è¯ï¼Œğ‘‘æ˜¯æ–‡æ¡£ï¼Œğ·æ˜¯æ–‡æ¡£é›†åˆã€‚\nBM25 #\rå¯¹TFIDFçš„ä¸€ç§æ”¹è¿›ï¼Œä¸ä»…è€ƒè™‘åˆ°äº†TFï¼ŒIDFã€‚è¿˜è€ƒè™‘åˆ°äº†æ–‡æ¡£çš„é•¿åº¦doc_lenã€‚æ–‡æ¡£è¶Šé•¿ï¼Œåˆ†æ•°è¶Šå°ã€‚å› ä¸ºè¶Šé•¿çš„æ–‡æ¡£èƒ½åŒ…å«çš„è¯é¡¹è‚¯å®šè¶Šå¤šè¶Šæ‚ï¼Œæ‰€ä»¥å¯¹é—®é¢˜çš„é’ˆå¯¹æ€§å›ç­”è‚¯å®šä¸ä¼šé‚£ä¹ˆå¥½ï¼Œç›´è§‚ä¸Šæ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚\nå±•æœ› #\råœ¨å®é™…å·¥ä¸šä¸­ï¼Œç‰¹åˆ«æ˜¯å¤§è§„æ¨¡æ•°æ®é›†ä¸­ï¼Œåº”è¯¥ä½¿ç”¨ä¸“ä¸šçš„æ–‡æ¡£æ£€ç´¢å·¥å…·ï¼Œæ¯”å¦‚Elasticsearchã€‚\nè¯­ä¹‰æ£€ç´¢ #\rè¿™ä¸€å—ç®—æ˜¯NLPåŸºç¡€ã€‚æœ€æ—©çš„word2vecå°±æ˜¯å°†è¯å˜æˆè¯­ä¹‰å‘é‡ã€‚BERTç­‰æ¨¡å‹åˆ™å¯ä»¥åšåˆ°æŠŠå¥å­å˜æˆè¯­ä¹‰å‘é‡ã€‚é€šè¿‡è®¡ç®—è¯­ä¹‰å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œå¯ä»¥è®¡ç®—å‡ºå¥å­é—´ï¼Œè¯ä¹‹é—´çš„ç›¸ä¼¼ç¨‹åº¦ã€‚æ¯”å¦‚apple companyå’Œiphoneï¼Œå¦‚æœåªé ä¹‹å‰çš„æ–‡æœ¬æ£€ç´¢ï¼Œç”±äºè¿™ä¸¤ä¸ªè¯ä¹‹é—´éƒ½æ²¡æœ‰ç›¸åŒçš„è¯ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ç‚¹ç›¸ä¼¼åº¦éƒ½æ²¡æœ‰ã€‚ä½†æ˜¯æˆ‘ä»¬å¦‚æœä»è¯­ä¹‰çš„è§’åº¦å‡ºå‘ï¼Œå¯ä»¥è¯´ä¸¤è€…ä¹‹é—´æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚\nè¿™ä¸ªä»»åŠ¡å«åšmtebï¼šMassive Text Embedding Benchmarkã€‚\nåœ¨è¯­ä¹‰æ£€ç´¢ä¹‹å‰ï¼Œéœ€è¦å¯¹æ–‡æœ¬è¿›è¡Œæ–‡æœ¬åˆ‡åˆ†ï¼Œå› ä¸ºæ¨¡å‹çš„è¾“å…¥æ˜¯æœ‰é•¿åº¦ä¸Šé™çš„ã€‚\nç›®å‰åœ¨RAGä¸­ï¼Œä¸»è¦æ˜¯æ–‡æœ¬æ£€ç´¢å’Œè¯­ä¹‰æ£€ç´¢ç»“åˆä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ›´é«˜çš„ç²¾åº¦ã€‚\nå¤šè·¯å¬å› #\ræ–‡æœ¬æ£€ç´¢ä¸­å¢åŠ æ£€ç´¢ç²¾åº¦çš„å¸¸ç”¨æ–¹æ³•ï¼Œé€šè¿‡å¤šç§å¬å›è·¯å¾„è¿›è¡Œç»¼åˆï¼Œæœ€åå¾—åˆ°å€™é€‰æ–‡æ¡£ã€‚ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡å¤šç§æ£€ç´¢æ–¹æ³•è¿›è¡Œæ£€ç´¢ï¼Œç„¶åå¯¹ç»“æœè¿›è¡ŒåŠ æƒè®¡ç®—å¾—åˆ°æœ€ç»ˆçš„åˆ†æ•°ï¼Œè¿™å°±æ˜¯å¤šè·¯å¬å›ã€‚\né‡æ’åº #\rå¦ä¸€ç§å¢åŠ ç²¾åº¦çš„æ–¹æ³•ã€‚å…·ä½“æ¥è¯´å°±æ˜¯å¯¹ç¬¬ä¸€æ¬¡æ£€ç´¢å‡ºçš„ç»“æœï¼Œç”¨å…¶ä»–æ›´å¼ºå¤§çš„æ¨¡å‹(ä¹Ÿå«Rerankæ¨¡å‹)è¿›è¡Œé‡æ’åºï¼Œå¾—åˆ°æ›´åŠ ç²¾ç¡®çš„ç»“æœã€‚\nä»å¤æ‚æ€§å’Œè®¡ç®—èµ„æºçš„è§’åº¦æ¥çœ‹ï¼ŒRerankæ¨¡å‹é€šå¸¸æ¯”åˆå§‹æ£€ç´¢æ¨¡å‹æ›´å¤æ‚ã€‚æ‰€ä»¥ä¸ç›´æ¥ä½¿ç”¨Rerankæ¨¡å‹ï¼Œè€Œæ˜¯åœ¨ç²—æ’ä¹‹åè¿›è¡Œç²¾æ’ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ç°åœ¨æƒ³è¦topkçš„æ£€ç´¢ç»“æœã€‚å…ˆç”¨åˆå§‹æ£€ç´¢æ¨¡å‹æ£€ç´¢å‡ºtop(k+N)ä¸ªç»“æœï¼Œç„¶åç”¨ç²¾æ’å¯¹k+Nä¸ªæ–‡æ¡£é‡æ–°æ’åºï¼Œå¾—åˆ°topkä¸ªç»“æœã€‚\næ€»ç»“ #\rRAGä½œä¸ºLLMçš„ä¸€é¡¹åº”ç”¨ï¼Œè¿˜æ˜¯è›®æœ‰å‰æ™¯çš„ï¼Œä¹‹åæ‰“ç®—æŠŠé¡¹ç›®æ‘¸ä¸€éï¼Œç†Ÿæ‚‰ç†Ÿæ‚‰ä»£ç ã€‚\n","date":"14 August 2024","externalUrl":null,"permalink":"/coding/llm_learning1/","section":"Codings","summary":"blog","title":"LLM RAGåˆæ­¥å­¦ä¹ ","type":"coding"},{"content":"","date":"10 August 2024","externalUrl":null,"permalink":"/life/","section":"Lives","summary":"","title":"Lives","type":"life"},{"content":"","date":"10 August 2024","externalUrl":null,"permalink":"/ja/categories/%E6%97%A5%E5%B8%B8/","section":"Categories","summary":"","title":"æ—¥å¸¸","type":"categories"},{"content":"","date":"10 August 2024","externalUrl":null,"permalink":"/categories/%E7%94%9F%E6%B4%BB/","section":"Categories","summary":"","title":"ç”Ÿæ´»","type":"categories"},{"content":"\ræœ€å¼€å§‹ #\rçœ‹åˆ°äº†ä¸€äº›å¾ˆå¸…æ°”çš„blogï¼Œäºæ˜¯è‡ªå·±ä¹Ÿæƒ³æ­ä¸ªç©ç©\nä»¥åå°±æœ‰åœ°æ–¹å†™codingä¸Šè¸©è¿‡çš„ä¸€äº›å‘ï¼Œä»¥åŠä¸Šä¼ è‡ªå·±åœ¨æ—¥æœ¬çš„æ¸¸è®°äº†ã€‚\næƒ³è¦æ‹ç…§ï¼\n","date":"10 August 2024","externalUrl":null,"permalink":"/life/test/","section":"Lives","summary":"blog","title":"çªå¦‚å…¶æ¥åœ°æƒ³æ­å»ºä¸€ä¸ªblog","type":"life"},{"content":"","date":"10 August 2024","externalUrl":null,"permalink":"/tags/%E6%9D%82%E8%B0%88/","section":"Tags","summary":"","title":"æ‚è°ˆ","type":"tags"},{"content":"","date":"10 August 2024","externalUrl":null,"permalink":"/ja/tags/%E9%9B%91%E8%AB%87/","section":"Tags","summary":"","title":"é›‘è«‡","type":"tags"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"}]